# ============================================================================
# PostgreSQL - Configuração Básica
# ============================================================================

# Database name to create on initialization
POSTGRES_DB=postgres

# PostgreSQL superuser name
POSTGRES_USER=postgres

# PostgreSQL superuser password (MUDE ISTO EM PRODUÇÃO!)
POSTGRES_PASSWORD=changeme

# PostgreSQL port (inside container: 5432, outside: this port)
POSTGRES_PORT=5432

# Timezone for PostgreSQL server
POSTGRES_INITDB_ARGS=-c timezone=UTC

# ============================================================================
# pgBackRest - Backup para S3 (OPCIONAL)
# ============================================================================

# Stanza name for pgBackRest (se vazio, backups desativados)
# Recomendação: use 'main' ou 'pg-prod'
PGBACKREST_STANZA=main

# Maximum parallel processes for backup/restore
PGBACKREST_PROCESS_MAX=2

# S3 Configuration - REQUERIDO apenas se PGBACKREST_STANZA estiver ativado
PGBACKREST_S3_BUCKET=your-s3-bucket-name
PGBACKREST_S3_ENDPOINT=s3.amazonaws.com
PGBACKREST_S3_REGION=us-east-1
PGBACKREST_S3_ACCESS_KEY=your-access-key
PGBACKREST_S3_SECRET_KEY=your-secret-key
PGBACKREST_S3_PATH=/pgbackrest

# ============================================================================
# Replicação - Cluster (OPCIONAL)
# ============================================================================

# Mode: 'primary' ou 'replica' (apenas se PGBACKREST_STANZA ativado)
PG_MODE=primary

# Replication user (para replicação)
REPLICA_USER=replication

# Replication password (use docker secrets em produção!)
REPLICA_PASSWORD=replication_password

# ============================================================================
# Retenção de Backups
# ============================================================================

# Number of full backups to keep
RETENTION_FULL=3

# Number of differential backups to keep
RETENTION_DIFF=14

# Number of full backups to keep WAL archives for
RETENTION_ARCHIVE=2

# ============================================================================
# Restauração
# ============================================================================

# Whether to restore from backup on startup
RESTORE_FROM_BACKUP=false

# ============================================================================
# Performance do PostgreSQL
# ============================================================================

# Shared buffer memory (normalmente 25% da RAM disponível)
SHARED_BUFFERS=1GB

# Effective cache size (normalmente 50-75% da RAM disponível)
EFFECTIVE_CACHE_SIZE=3GB

# Memory for maintenance operations
MAINTENANCE_WORK_MEM=256MB

# Memory per operation
WORK_MEM=16MB

# Maximum WAL senders for replication
MAX_WAL_SENDERS=10

# Maximum replication slots
MAX_REPLICATION_SLOTS=10

# ============================================================================
# Exemplo de Modo Compatível (Drop-in Replacement)
# ============================================================================
# Para usar como drop-in replacement de postgres:18-alpine:
# POSTGRES_DB=solution_db
# POSTGRES_USER=solution_user
# POSTGRES_PASSWORD=solution_password
# (deixar PGBACKREST_STANZA vazio ou comentado)
# Use: docker-compose.compat.yml

# ============================================================================
# Exemplo de Modo com Backups
# ============================================================================
# Para usar com backups S3:
# POSTGRES_DB=backup_db
# POSTGRES_USER=backup_user
# POSTGRES_PASSWORD=strong_password
# PGBACKREST_STANZA=pg-prod
# PGBACKREST_S3_BUCKET=my-backup-bucket
# PGBACKREST_S3_REGION=us-west-2
# PGBACKREST_S3_ACCESS_KEY=AKIA...
# PGBACKREST_S3_SECRET_KEY=...
# Use: docker-compose.yml

# ============================================================================
# Segurança
# ============================================================================
# 1. NUNCA commit este arquivo com senhas reais no Git
# 2. Use .gitignore para excluir arquivo .env local
# 3. Em produção, use docker secrets para senhas
# 4. SSL está ativado automaticamente com certificados auto-assinados
# 5. Mude POSTGRES_PASSWORD de 'changeme' para uma senha forte
# 6. Configure AWS_ACCESS_KEY_ID e AWS_SECRET_ACCESS_KEY com segurança
